<!-- Copyright 2014 Open Ag Data Alliance

     Licensed under the Apache License, Version 2.0 (the 'License');
     you may not use this file except in compliance with the License.
     You may obtain a copy of the License at

         http://www.apache.org/licenses/LICENSE-2.0

     Unless required by applicable law or agreed to in writing, software
     distributed under the License is distributed on an 'AS IS' BASIS,
     WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
     See the License for the specific language governing permissions and
     limitations under the License.
-->

<html>
<head>
    <script src=main.browserify.js></script>
    <script src=https://medialize.github.io/URI.js/src/URI.js></script>
    <link rel='stylesheet' href='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/styles/default.min.css'>
    <script src='https://cdnjs.cloudflare.com/ajax/libs/highlight.js/8.2/highlight.min.js'></script>
    <script>
        var metadata = 'eyJqa3UiOiJodHRwczovL2lkZW50aXR5Lm9hZGEtZGV2LmNvbS9jZXJ0cyIsImtpZCI6ImtqY1NjamMzMmR3SlhYTEpEczNyMTI0c2ExIiwidHlwIjoiSldUIiwiYWxnIjoiUlMyNTYifQ.eyJyZWRpcmVjdF91cmlzIjpbImh0dHBzOi8vZXhhbXBsZS5jb20vcmVkaXJlY3QiXSwidG9rZW5fZW5kcG9pbnRfYXV0aF9tZXRob2QiOiJ1cm46aWV0ZjpwYXJhbXM6b2F1dGg6Y2xpZW50LWFzc2VydGlvbi10eXBlOmp3dC1iZWFyZXIiLCJncmFudF90eXBlcyI6WyJpbXBsaWNpdCIsImF1dGhvcml6YXRpb25fY29kZSJdLCJyZXNwb25zZV90eXBlcyI6WyJ0b2tlbiIsImNvZGUiLCJpZF90b2tlbiIsImlkX3Rva2VuIHRva2VuIiwiY29kZSBpZF90b2tlbiIsImNvZGUgdG9rZW4iLCJjb2RlIGlkX3Rva2VuIHRva2VuIl0sImNsaWVudF9uYW1lIjoiT0FEQSBDb25mb3JtYW5jZSBUZXN0cyIsImNsaWVudF91cmkiOiJodHRwczovL3Rlc3Qub2FkYS1kZXYuY29tIiwiY29udGFjdHMiOlsiSW5mbyA8aW5mb0BvcGVuYWcuaW8-Il0sInBvbGljeV91cmkiOiJodHRwczovL3Rlc3Qub2FkYS1kZXYuY29tL3B1Yy5odG1sIiwidG9zX3VyaSI6Imh0dHBzOi8vdGVzdC5vYWRhLWRldi5jb20vcHVjLmh0bWwiLCJsaWNlbnNlcyI6W3siaWQiOiJvYWRhLTEuMCIsIm5hbWUiOiJPQURBIEV4YW1wbGUgdjEuMCJ9XSwiandrcyI6eyJrZXlzIjpbeyJrdHkiOiJSU0EiLCJraWQiOiJramY5aXUzbmN6a2pkZjl3MyIsInVzZSI6InNpZyIsIm4iOiJBTThwM1dxVGZ1UnBjd1ZmX0lXNjk5TkVTTmhtaURfOVYwekhwM2dUNFllWjBsalR1WTQwaWZXcm8xSWZGQkZLU3d2aHlaakwwZE5PQnZUb2c2YU1VVFZSbUlZQlg2Tl9HRVVmNWtkLUlqOFRrSGJkejc1VE5ZbVVuTkllZUFDWnFCLXJyNlBlUVJQOVkxN0JxZXFZNXJqdjVybDVyZWQ4S0hDYlBNTXNLTkF0dmV1X21wVWV4dVpVZ1FQQm5aY3hEODdTQnVYczJleFdNenNMTHdLZUdONHBQV2hSZUtBYnN1Sngtb1lSemFLMk5EazRrX0xSdEVKa0djQVM3NjV4UnRuTkpoSXp3ZmNxbEY3VERsVEZhM2J2ZG5nZzVCaUFpQWwzVERPV19TUlhteGhOUS1DTU90UlFGZGhKV25GemFsOHpLMk9XM1dtajVnTk9YbEg2RXhVIiwiZSI6IkFRQUIifV19LCJzb2Z0d2FyZV9pZCI6ImNhZjExZDNjLTRjZmUtNDdjZC04MWEzLWEzYjY0NGU1Yzg0ZSIsInJlZ2lzdHJhdGlvbl9wcm9pdmRlciI6Imh0dHBzOi8vaWRlbnRpdHkub2FkYS1kZXYuY29tIiwiaWF0IjoxNDQwNzMwODY1fQ.lyHnTSQ5-7U1t_rbRpQ7KDmwiBQEeAVNK7d4Z7kaaDUfrOYfKYXxdMAFmEIcPyw1lYg6DeBypY3bT6RgNyJXiPpm25kRgMuUpvq_eSUlRAXFRug-vpNgmjqb948heA41yztihGBKtgy47x5u6oBTb3sfkUZFzXfBHUeFmtr1AGk';
        var options = {
            metadata: metadata,
            redirect: 'https://client.oada-dev.com/redirect.html',
            scope: 'bookmarks.machines.harvesters bookmarks.fields bookmarks.clients resources',
            // Make it always ask for consent again
            prompt: 'consent'
        };

        // Ugly. Object.assign() would be nice...
        var optionsIdTokenToken = {
            metadata: metadata,
            redirect: 'https://client.oada-dev.com/redirect.html',
            scope: options.scope,
            prompt: options.prompt,
            'response_type': 'id_token token'
        };

        var googleOptions = {
            'client_id': '222922449179-va3k4ldqsg9aq5kmv4db8jvlijvv5s8p' +
                '.apps.googleusercontent.com',
            'redirect_uri': URI('redirect.html')
                .absoluteTo(window.location.href),
            scope: 'https://mail.google.com/',
            // Make it always ask for consent again
            prompt: 'consent',
        };

        var callback = function(err, token) {
            'use strict';

            if (err) {
                if (console && (typeof console.dir === 'function')) {
                    console.dir(err);
                }
                alert(err);
            }

            var block = document.getElementById('token');

            block.innerHTML =
                JSON.stringify(token, undefined, 4);
            hljs.highlightBlock(block);
        };
    </script>
</head>
<body>

<h1>OAuth 2.0 Implicit Flow</h1>
<h2>Web Client</h2>
<button onclick='oadaIdClient.getIDToken("identity.oada-dev.com",
    optionsIdTokenToken, callback)'>
    ID Token and Access Token from identity.oada-dev.com</button>
<button onclick='oadaIdClient.getIDToken("identity.oada-dev.com", options,
    callback)'>ID Token from identity.oada-dev.com</button>
<button onclick='oadaIdClient.getAccessToken("identity.oada-dev.com", options,
    callback)'>Access Token from identity.oada-dev.com</button>
<button onclick='oadaIdClient.getAccessToken("provider.oada-dev.com", options,
    callback)'>Access Token from provider.oada-dev.com</button>

<h2>Web Client to Unknown Provider</h2>

<div>
    <label for='id_tok_domain'>Domain:</label>
    <input id='id_tok_domain' type='text' />
    <label for='id_tok_scope'>Scope:</label>
    <input id='id_tok_scope' type='text' value='openid profile' />
    <button onclick='var opts = optionsIdTokenToken; opts.scope = document.getElementById("id_tok_scope").value; oadaIdClient.getIDToken(document.getElementById("id_tok_domain").value, opts, callback)'>Get ID Token and Access Token</button>
</div>
<br />
<div>
    <label for='id_domain'>Domain:</label>
    <input id='id_domain' type='text' />
    <label for='id_scope'>Scope:</label>
    <input id='id_scope' type='text' value='openid profile' />
    <button onclick='var opts = options; opts.scope = document.getElementById("id_scope").value; oadaIdClient.getIDToken(document.getElementById("id_domain").value, opts, callback)'>Get ID Token</button>
</div>
<br />
<div>
    <label for='ac_domain'>Domain:</label>
    <input id='ac_domain' type='text' value='www.valleyix.com/oada/web/' />
    <label for='ac_scope'>Scope:</label>
    <input id='ac_scope' type='text' value='Read:oada.irrigation.metadata Create:oada.irrigation.machines.work-order Create:oada.irrigation.machines.prescription Read:oada.irrigation.machines.configuration Read:oada.irrigation.machines.status Read:oada.irrigation.machines.asapplieddata  Read:oada.clients Read:valley.basestation3 Read:oada.irrigation.machines.vrizones' />
    <button onclick='var opts = options; opts.scope = document.getElementById("ac_scope").value; oadaIdClient.getAccessToken(document.getElementById("ac_domain").value, opts, callback)'>Get Access Token</button>
</div>

<h2>ID/Access Token Result</h2>

<pre class='json' id='token'>Choose an OAuth 2.0/OpenID Connect method from above</pre>

<hr />

<h1>OAuth 2.0 Code Flow<h1>
<h2>Server to Server</h2>

<a href='/who_identity'>ID Token from identity.oada-dev.com</a> |
<a href='/get_identity'>Access Token from identity.oada-dev.com</a> |
<a href='/get_provider'>Access Token from provider.oada-dev.com</a>

<h2>Server to Unknown Server</h1>
<form action='/get_identity'  method='get'>
    <div>
        <label for='domain'>Domain:</label>
        <input type='text' name='domain' />
        <label for='scope'>Scope:</label>
        <input type='text' name='scope' value='bookmarks.clients' />
        <button type='submit'>Get Access Token</button>
    </div>
</form>
<form action='/who_identity'  method='get'>
    <div>
        <label for='domain'>Domain:</label>
        <input type='text' name='domain' />
        <label for='scope'>Scope:</label>
        <input type='text' name='scope' value='openid profile' />
        <button type='submit'>Get ID Token</button>
    </div>
</form>
<hr />

<h1>Logout</h1>

<a href='https://identity.oada-dev.com/logout'>Logout of
    identity.oada-dev.com</a>
<br />
<br />
<a href='https://provider.oada-dev.com/logout'>Logout of
    provider.oada-dev.com</a>

</body>
</html>

